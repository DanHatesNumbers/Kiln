name: Vulnerable Dependency Check
on: [push]

jobs:
    vulnerable-dependency-check:
        name: Check for dependencies on vulnerable crates
        runs-on: ubuntu-18.04
        steps:
          - name: Checkout
            uses: actions/checkout@v1
          - name: Install stable toolchain
            uses: actions-rs/toolchain@v1
            with:
              toolchain: stable
              override: true
          - name: Install cargo audit
            run: cargo install cargo-audit
          - name: Run cargo audit
            run: cargo audit --deny-warnings
            working-directory: data-collector/
          - name: Dump GitHub context
	    if: failure()
            env:
                GITHUB_CONTEXT: ${{ toJson(github) }}
            run: echo "$GITHUB_CONTEXT"
          - name: Dump job context
	    if: failure()
            env:
                JOB_CONTEXT: ${{ toJson(job) }}
            run: echo "$JOB_CONTEXT"
          - name: Dump steps context
            if: failure()
            env:
                STEPS_CONTEXT: ${{ toJson(steps) }}
            run: echo "$STEPS_CONTEXT"
          - name: Dump runner context
            if: failure()
            env:
                RUNNER_CONTEXT: ${{ toJson(runner) }}
            run: echo "$RUNNER_CONTEXT"
          - name: Dump strategy context
            if: failure()
            env:
                STRATEGY_CONTEXT: ${{ toJson(strategy) }}
            run: echo "$STRATEGY_CONTEXT"
          - name: Dump matrix context
            if: failure()
            env:
                MATRIX_CONTEXT: ${{ toJson(matrix) }}
            run: echo "$MATRIX_CONTEXT" 
