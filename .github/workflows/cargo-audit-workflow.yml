name: Vulnerable Dependency Check
on: [push]

jobs:
    vulnerable-dependency-check:
        name: Check for dependencies on vulnerable crates
        runs-on: ubuntu-18.04
        steps:
          - name: Checkout
            uses: actions/checkout@v1
          - name: Install stable toolchain
            uses: actions-rs/toolchain@v1
            with:
              toolchain: stable
              override: true
          - name: Install cargo audit
            run: cargo install cargo-audit
          - name: Run cargo audit
            run: cargo audit --deny-warnings
            working-directory: data-collector/
          - name: Create an issue if the vulnerable dependency check fails
            if: failure()
            uses: JasonEtco/create-an-issue@master
            env: 
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
         
